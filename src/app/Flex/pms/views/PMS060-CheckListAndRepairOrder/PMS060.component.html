<!-- list -->
<mat-card [hidden]="data" class="animated fadeIn card-margin">
    <div class="row">
        <div class="col-lg-12">
            <h2><span class="flex-title" [flexLabel]="'lblHeader'">Checklist and Repair Order</span></h2>
        </div>
    </div>
    <mat-expansion-panel [expanded]="true">
        <mat-expansion-panel-header [@.disabled]="true" expandedHeight="54px" collapsedHeight="54px">
            <mat-panel-title>Search Criteria</mat-panel-title>
        </mat-expansion-panel-header>
        <mat-card-content>
            <!--
                ################ Criteria ################
            -->
            <form (ngSubmit)="LoadData()" #criteriaForm="ngForm" autocomplete="off">
                <div class="col-12">
                    <div class="row">
                        <mat-form-field class="col-sm-6 col-lg-3">
                            <mat-label>Request Date - From</mat-label>
                            <input matInput [matDatepicker]="ReqDateFrom" id="RequestDateFrom" name="RequestDateFrom"
                                [(ngModel)]="criteria.REQUEST_DATE_FROM">
                            <mat-datepicker-toggle matSuffix [for]="ReqDateFrom"></mat-datepicker-toggle>
                            <mat-datepicker #ReqDateFrom></mat-datepicker>
                        </mat-form-field>
                        <mat-form-field class="col-sm-6 col-lg-3">
                            <mat-label>Request Date - To</mat-label>
                            <input matInput [matDatepicker]="ReqDateTo" id="RequestDateTo" name="RequestDateTo"
                                [(ngModel)]="criteria.REQUEST_DATE_TO">
                            <mat-datepicker-toggle matSuffix [for]="ReqDateTo"></mat-datepicker-toggle>
                            <mat-datepicker #ReqDateTo></mat-datepicker>
                        </mat-form-field>

                        <mat-form-field class="col-sm-6 col-lg-3">
                            <mat-label>Test Date - From</mat-label>
                            <input matInput [matDatepicker]="TestDateFrom" id="TestDateFrom" name="TestDateFrom"
                                [(ngModel)]="criteria.TEST_DATE_FROM">
                            <mat-datepicker-toggle matSuffix [for]="TestDateFrom"></mat-datepicker-toggle>
                            <mat-datepicker #TestDateFrom></mat-datepicker>
                        </mat-form-field>
                        <mat-form-field class="col-sm-6 col-lg-3">
                            <mat-label>Test Date - To</mat-label>
                            <input matInput [matDatepicker]="TestDateTo" id="TestDateTo" name="TestDateTo"
                                [(ngModel)]="criteria.TEST_DATE_TO">
                            <mat-datepicker-toggle matSuffix [for]="TestDateTo"></mat-datepicker-toggle>
                            <mat-datepicker #TestDateTo></mat-datepicker>
                        </mat-form-field>
                    </div>
                    <div class="row">

                        <mat-form-field class="col-sm-6 col-lg-3">
                            <mat-label>Complete Date - From</mat-label>
                            <input matInput [matDatepicker]="CompleteDateFrom" id="CompleteDateFrom"
                                name="CompleteDateFrom" [(ngModel)]="criteria.COMPLETE_DATE_FROM">
                            <mat-datepicker-toggle matSuffix [for]="CompleteDateFrom"></mat-datepicker-toggle>
                            <mat-datepicker #CompleteDateFrom></mat-datepicker>
                        </mat-form-field>
                        <mat-form-field class="col-sm-6 col-lg-3">
                            <mat-label>Complete Date - To</mat-label>
                            <input matInput [matDatepicker]="CompleteDateTo" id="CompleteDateTo" name="CompleteDateTo"
                                [(ngModel)]="criteria.COMPLETE_DATE_TO">
                            <mat-datepicker-toggle matSuffix [for]="CompleteDateTo"></mat-datepicker-toggle>
                            <mat-datepicker #CompleteDateTo></mat-datepicker>
                        </mat-form-field>

                        <mat-form-field class="col-sm-6 col-lg-3">
                            <mat-label>Repair No. From</mat-label>
                            <input matInput id="REPNoFrom" name="REPNoFrom" type="text"
                                [(ngModel)]="criteria.CHECK_REP_NO_FROM">
                        </mat-form-field>
                        <mat-form-field class="col-sm-6 col-lg-3">
                            <mat-label>Repair No. To</mat-label>
                            <input matInput id="REPNoTo" name="REPNoTo" type="text"
                                [(ngModel)]="criteria.CHECK_REP_NO_TO">
                        </mat-form-field>


                    </div>
                    <div class="row">

                        <mat-form-field class="col-sm-6 col-lg-3">
                            <mat-label>PO Number From</mat-label>
                            <input matInput id="PONumberFrom" name="PONumberFrom" type="text"
                                [(ngModel)]="criteria.PONUMBER_FROM">
                        </mat-form-field>
                        <mat-form-field class="col-sm-6 col-lg-3">
                            <mat-label>PO Number To</mat-label>
                            <input matInput id="PONumberTo" name="PONumberTo" type="text"
                                [(ngModel)]="criteria.PONUMBER_TO">
                        </mat-form-field>

                        <mat-form-field class="col-sm-6 col-lg-3">
                            <mat-label>Person In Charge</mat-label>
                            <select matNativeControl id="PersonInCharge" name="PersonInCharge"
                                [(ngModel)]="criteria.PERSONINCHARGE">
                                <!-- <option value=""></option> -->
                                <option *ngFor="let c of comboUserWithPosition" [value]="c.VALUE">{{c.DISPLAY}}</option>
                            </select>
                        </mat-form-field>

                        <mat-form-field class="col-sm-6 col-lg-3">
                            <mat-label>Requester</mat-label>
                            <select matNativeControl id="Requester" name="Requester" [(ngModel)]="criteria.REQUESTER">
                                <!-- <option value=""></option> -->
                                <option *ngFor="let c of comboUserWithPosition" [value]="c.VALUE">{{c.DISPLAY}}</option>
                            </select>
                        </mat-form-field>

                    </div>
                    <div class="row">
                        <mat-form-field class="col-sm-6 col-lg-3">
                            <mat-label>Location</mat-label>
                            <select matNativeControl id="Location" name="Location"
                                [(ngModel)]="criteria.MACHINE_LOC_CD">
                                <!-- <option value=""></option> -->
                                <option *ngFor="let c of comboLocation" [value]="c.VALUE">{{c.DISPLAY}}</option>
                            </select>
                        </mat-form-field>

                        <mat-form-field class="col-sm-6 col-lg-3">
                            <mat-label>Approver</mat-label>
                            <select matNativeControl id="Approver" name="Approver" [(ngModel)]="criteria.CUR_PERSON">
                                <!-- <option value=""></option> -->
                                <option *ngFor="let c of comboUserWithPosition" [value]="c.VALUE">{{c.DISPLAY}}</option>
                            </select>
                        </mat-form-field>

                        <mat-form-field class="col-sm-6 col-lg-3">
                            <mat-label>Machine No. From</mat-label>
                            <select matNativeControl id="MaxhineNoFrom" name="MaxhineNoFrom"
                                [(ngModel)]="criteria.MACHINE_NO_FROM">
                                <!-- <option value=""></option> -->
                                <option *ngFor="let c of comboMachine" [value]="c.VALUE">{{c.DISPLAY}}</option>
                            </select>
                        </mat-form-field>

                        <mat-form-field class="col-sm-6 col-lg-3">
                            <mat-label>Machine No. To</mat-label>
                            <select matNativeControl id="MachineNoTo" name="MachineNoTo"
                                [(ngModel)]="criteria.MACHINE_NO_TO">
                                <!-- <option value=""></option> -->
                                <option *ngFor="let c of comboMachine" [value]="c.VALUE">{{c.DISPLAY}}</option>
                            </select>
                        </mat-form-field>

                    </div>
                    <div class="row">
                        <mat-form-field class="col-sm-6 col-lg-3">
                            <mat-label>Machine Name</mat-label>
                            <input matInput id="MachineName" name="MachineName" type="text"
                                [(ngModel)]="criteria.MACHINE_NAME">
                        </mat-form-field>

                        <mat-form-field class="col-sm-6 col-lg-3">
                            <mat-label>Supplier</mat-label>
                            <select matNativeControl id="Supplier" name="Supplier" [(ngModel)]="criteria.VENDORID">
                                <!-- <option value=""></option> -->
                                <option *ngFor="let c of comboSupplier" [value]="c.VALUE">{{c.DISPLAY}}</option>
                            </select>
                        </mat-form-field>

                        <mat-form-field class="col-sm-6 col-lg-3">
                            <mat-label>Schedule Type</mat-label>
                            <select matNativeControl id="Schedule Type" name="Schedule Type"
                                [(ngModel)]="criteria.SCHEDULE_TYPEID">
                                <!-- <option value=""></option> -->
                                <option *ngFor="let c of comboSchduleType" [value]="c.VALUE">{{c.DISPLAY}}</option>
                            </select>
                        </mat-form-field>

                        <mat-form-field class="col-sm-6 col-lg-3">
                            <mat-label>Status</mat-label>
                            <select matNativeControl id="Status" name="Status" [(ngModel)]="criteria.STATUSID">
                                <!-- <option value=""></option> -->
                                <option *ngFor="let c of comboStatus" [value]="c.VALUE">{{c.DISPLAY}}</option>
                            </select>
                        </mat-form-field>

                    </div>
                    <div class="row">
                        <div class="col-12">
                            <button mat-flat-button color="primary" type="submit"
                                [disabled]="!criteriaForm.valid || isLoading">Search</button>
                            <button mat-stroked-button type="button" [disabled]="isLoading" (click)="OnAddNew()">Add
                                New</button>
                            <button mat-stroked-button type="button" [disabled]="isLoading"
                                (click)="OnClear()">Clear</button>
                        </div>
                    </div>
                </div>
            </form>
        </mat-card-content>
    </mat-expansion-panel>
    <mat-expansion-panel [expanded]="true" *ngIf="dataList">
        <mat-expansion-panel-header [@.disabled]="true" expandedHeight="54px" collapsedHeight="54px">
            <mat-panel-title>Search Result</mat-panel-title>
        </mat-expansion-panel-header>
        <mat-card-content>
            <!--
                ################ Detail ################
            -->
            <mat-list *ngIf="dataList">
                <mat-list-item>Result: {{dataList?.length}} rows</mat-list-item>
            </mat-list>
            <mat-list *ngIf="dataList">
                <mat-list-item *ngFor="let row of dataList" (click)="OnEdit(row)">
                    <mat-icon mat-list-icon>folder</mat-icon>
                    <h4 mat-line>Checklist/Repair No. : {{row.CHECK_REP_NO}}</h4>
                    <p mat-line>{{row.MACHINE_NO}} : {{row.MACHINE_NAME}}</p>
                    <small mat-line>Schedule Type : {{row.SCHEDULE_NAME}}</small>
                    <small mat-line>Req./Comp. Date : {{row.DISPLAY_DATE | date: 'dd/MMM/yyyy'}}</small>
                    <small mat-line>{{row.STATUS_DISPLAY}}</small>
                    <!-- <p mat-line> {{row.updated | date}} </p> -->
                </mat-list-item>
            </mat-list>
        </mat-card-content>
    </mat-expansion-panel>
</mat-card>

<!-- over haul -->
<mat-card *ngIf="data && data.Header.SCHEDULE_TYPEID===1" class="animated fadeIn card-margin">

    <mat-card-actions>
        <button *ngIf="tsbCompleteMtnVisible()" class="button" mat-flat-button color="primary"
            [disabled]="!formOH.valid || isLoading || notHavePermission" (click)="onCompleteMTN()">
            Complete (MTN)
        </button>
        <button
            *ngIf="tsbCompletRqVisible()"
            class="button" mat-flat-button color="primary" [disabled]="!formOH.valid || isLoading || notHavePermission"
            (click)="onCompleteRQ()">
            Complete (RQ)
        </button>
        <button
            *ngIf="data.Header.CHECK_REPH_ID && data.Header.STATUSID!=STATUS_CANCEL && data.Header.STATUSID!=STATUS_DURING_APPROVE && data.Header.STATUSID!=STATUS_COMPLETE"
            class="button" mat-flat-button color="warn" [disabled]="!formOH.valid || isLoading || notHavePermission"
            (click)="onCancelOH()">
            Cancel
        </button>
    </mat-card-actions>

    <form (ngSubmit)="SaveOH()" #formOH="ngForm" autocomplete="off">

        <div class="row">
            <div class="col-lg-6">
                <!-- <mat-card-header>
                    <mat-card-title>Checklist/Repair No. : {{data.Header.CHECK_REP_NO}}</mat-card-title>
                </mat-card-header> -->
                <h2><span class="flex-title">Checklist/Repair No. : {{data.Header.CHECK_REP_NO}}</span></h2>
            </div>
            <div class="col-lg-6">
                <!-- <mat-card-header class="text-right">
                    <mat-card-title>Status : {{status.STATUSID + ' : ' + status.STATUSNAME}}</mat-card-title>
                </mat-card-header> -->
                <h2><span class="flex-status">Status : {{status.STATUSID + ' : ' + status.STATUSNAME}}</span></h2>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <!-- <mat-card-header>
                    <mat-card-title>Checklist/Repair No. : {{data.Header.CHECK_REP_NO}}</mat-card-title>
                </mat-card-header> -->
                <h2><span class="flex-title-2">Machine No. : {{MachineDisplay}}</span></h2>
            </div>
        </div>

        <mat-accordion [multi]="true">
            <mat-expansion-panel [expanded]="true">
                <mat-expansion-panel-header [@.disabled]="true" expandedHeight="54px" collapsedHeight="54px">
                    <mat-panel-title>Over Haul Information
                    </mat-panel-title>
                </mat-expansion-panel-header>


                <mat-card-content>
                    <div class="col-12">
                        <div class="row">

                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Machine No.</mat-label>
                                <select matNativeControl id="MachineNo" name="MachineNo"
                                    [disabled]="data.Header.MACHINE_SCHEDULEID!=null || notHavePermission"
                                    [(ngModel)]="data.Header.MACHINE_NO" (change)="onMachineNoChange()">
                                    <!-- <option value=""></option> -->
                                    <option *ngFor="let c of comboMachine" [value]="c.VALUE">{{c.DISPLAY}}
                                    </option>
                                </select>
                            </mat-form-field>

                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Machine Name</mat-label>
                                <input matInput required id="MachineName" name="MachineName" type="text"
                                    [disabled]="data.Header.MACHINE_SCHEDULEID!=null || notHavePermission"
                                    [(ngModel)]="data.Header.MACHINE_NAME" (change)="onMachineNameChange()">
                            </mat-form-field>

                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Request Date</mat-label>
                                <input matInput required [matDatepicker]="ReqDate" id="ReqDate" name="ReqDate"
                                    [disabled]="notHavePermission"
                                    [(ngModel)]="data.Header.REQUEST_DATE">
                                <mat-datepicker-toggle matSuffix [for]="ReqDate"></mat-datepicker-toggle>
                                <mat-datepicker #ReqDate></mat-datepicker>
                            </mat-form-field>

                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Complete Date</mat-label>
                                <input matInput [matDatepicker]="CompleteDate" id="CompleteDate" name="CompleteDate"
                                [disabled]="notHavePermission"
                                    [(ngModel)]="data.Header.COMPLETE_DATE">
                                <mat-datepicker-toggle matSuffix [for]="CompleteDate"></mat-datepicker-toggle>
                                <mat-datepicker #CompleteDate></mat-datepicker>
                            </mat-form-field>

                        </div>

                        <div class="row">
                            <div class="col-sm-12 col-lg-6">
                                <div class="row">
                                    <mat-form-field class="col-sm-6 col-lg-6">
                                        <mat-label>Person In Charge</mat-label>
                                        <select matNativeControl id="PersonInCharge" name="PersonInCharge"
                                            [disabled]="notHavePermission" [(ngModel)]="SelectedPersonInCharge">
                                            <!-- <option value=""></option> -->
                                            <option *ngFor="let c of comboUserWithPosition" [value]="c.VALUE">
                                                {{c.DISPLAY}}
                                            </option>
                                        </select>
                                    </mat-form-field>
                                    <div class="col-sm-6 col-lg-6">
                                        <button type="button" mat-stroked-button [disabled]="notHavePermission"
                                            (click)="AddPersonIncharge()">Add</button>
                                        <button type="button" mat-stroked-button [disabled]="notHavePermission"
                                            (click)="RemovePersonIncharge()">Remove</button>
                                    </div>
                                </div>
                                <div class="row">
                                    <table class="border" mat-table [dataSource]="dataSourcePersonInCharge" >
                                        <!-- checkbox colunm -->
                                        <ng-container matColumnDef="SELECT">
                                            <td mat-cell *matCellDef="let row" class="grid-checkbox-column">
                                                <mat-checkbox (click)="$event.stopPropagation()"
                                                    (change)="$event ? selectionPersonInCharge.toggle(row) : null"
                                                    [checked]="selectionPersonInCharge.isSelected(row)">
                                                </mat-checkbox>
                                            </td>
                                        </ng-container>

                                        <ng-container matColumnDef="DISPLAY">
                                            <td mat-cell *matCellDef="let row"> {{row.DISPLAY}} </td>
                                        </ng-container>

                                        <tr mat-row
                                            *matRowDef="let row; let i = index; columns: displayedColumnsPersonInCharge;"
                                            (click)="selectionPersonInCharge.toggle(row)">
                                        </tr>
                                    </table>
                                </div>
                            </div>

                            <div class="col-sm-12 col-lg-6">
                                <div class="row">

                                    <mat-form-field class="col-sm-6 col-lg-6">
                                        <mat-label>Supplier</mat-label>
                                        <select matNativeControl id="Supplier" name="Supplier"
                                        [disabled]="notHavePermission"
                                            [(ngModel)]="data.HeaderOverHaul.VENDORID">
                                            <!-- <option value=""></option> -->
                                            <option *ngFor="let c of comboSupplier" [value]="c.VALUE">
                                                {{c.DISPLAY}}
                                            </option>
                                        </select>
                                    </mat-form-field>

                                    <mat-form-field class="col-sm-6 col-lg-6">
                                        <mat-label>PO Number</mat-label>
                                        <select matNativeControl id="PONumber" name="PONumber"
                                        [disabled]="notHavePermission"
                                            [(ngModel)]="data.HeaderOverHaul.POHID">
                                            <!-- <option value=""></option> -->
                                            <option *ngFor="let c of comboPoNumber" [value]="c.VALUE">
                                                {{c.DISPLAY}}
                                            </option>
                                        </select>
                                    </mat-form-field>
                                </div>
                                <div class="row">
                                    <mat-form-field class="col-sm-6 col-lg-6">
                                        <mat-label>Machine Location</mat-label>
                                        <input matInput id="MachineLocation" name="MachineLocation" type="text"
                                        [disabled]="notHavePermission"
                                            [(ngModel)]="data.Header.MACHINE_LOC">
                                    </mat-form-field>

                                    <mat-form-field class="col-sm-6 col-lg-6">
                                        <mat-label>Total Time of Operation (hr.)</mat-label>
                                        <input matInput id="TotalTimeOfOperation" name="TotalTimeOfOperation"
                                        [disabled]="notHavePermission"
                                            type="number" [(ngModel)]="data.HeaderOverHaul.TOTAL_TIME_OPERATION">
                                    </mat-form-field>

                                </div>
                            </div>


                        </div>
                    </div>
                </mat-card-content>


            </mat-expansion-panel>
            <mat-expansion-panel [expanded]="true">
                <mat-expansion-panel-header [@.disabled]="true" expandedHeight="54px" collapsedHeight="54px">
                    <mat-panel-title>Repair Information
                    </mat-panel-title>
                    <!-- <mat-panel-description>
                        Currently I am {{panelOpenState ? 'open' : 'closed'}}
                    </mat-panel-description> -->
                </mat-expansion-panel-header>

                <mat-card-content>
                    <div class="col-12">
                        <div class="row">

                            <mat-form-field class="col-sm-12 col-lg-12">
                                <mat-label>Detail of Problems or Disorder</mat-label>
                                <textarea matInput id="PROBLEM_DESC" name="PROBLEM_DESC" type="text"
                                [disabled]="notHavePermission"
                                    [(ngModel)]="data.HeaderOverHaul.PROBLEM_DESC">
                                    </textarea>
                            </mat-form-field>

                            <mat-form-field class="col-sm-12 col-lg-12">
                                <mat-label>Repair Method</mat-label>
                                <textarea matInput id="REPAIR_METHOD" name="REPAIR_METHOD" type="text"
                                [disabled]="notHavePermission"
                                    [(ngModel)]="data.HeaderOverHaul.REPAIR_METHOD">
                                    </textarea>
                            </mat-form-field>


                            <mat-form-field class="col-sm-12 col-lg-12">
                                <mat-label>Cause of Delay</mat-label>
                                <input matInput id="CAUSE_DELAY" name="CAUSE_DELAY" type="text"
                                [disabled]="notHavePermission"
                                    [(ngModel)]="data.HeaderOverHaul.CAUSE_DELAY">
                            </mat-form-field>

                            <!-- 
                            <mat-form-field class="col-sm-12 col-lg-12">
                                <mat-label>Ref. Checklist/Repair No.</mat-label>
                                <input matInput id="CHECK_REP_NO_REF" name="CHECK_REP_NO_REF" type="text"
                                [disabled]="notHavePermission"
                                    [(ngModel)]="data.HeaderOverHaul.CHECK_REP_NO_REF">
                            </mat-form-field> -->


                        </div>
                    </div>
                </mat-card-content>

            </mat-expansion-panel>
        </mat-accordion>


        <mat-card-actions>
            <button mat-flat-button color="primary" type="submit" [disabled]="!formOH.valid || isLoading || notHavePermission">Save</button>
            <button mat-flat-button (click)="Back()">Back</button>
        </mat-card-actions>

    </form>
</mat-card>

<!-- pm -->
<mat-card *ngIf="!tempPmData && data && data.Header.SCHEDULE_TYPEID===2" class="animated fadeIn card-margin">
    <mat-card-actions *ngIf="data.Header.CHECK_REPH_ID">
        <button
            *ngIf="data.Header.CHECK_REPH_ID && data.Header.STATUSID===STATUS_NEW || data.Header.STATUSID===STATUS_REVISE"
            class="button" mat-flat-button color="primary" [disabled]="!formOH.valid || isLoading"
            (click)="onSendToApprovePM()">
            Send to Approve
        </button>
        <button *ngIf="data.Header.CHECK_REPH_ID && data.Header.STATUSID===STATUS_DURING_APPROVE " class="button"
            mat-flat-button color="primary" [disabled]="!formOH.valid || isLoading" (click)="onApprovePM()">
            Approve
        </button>
        <button *ngIf="data.Header.CHECK_REPH_ID && data.Header.STATUSID===STATUS_DURING_APPROVE" class="button"
            mat-flat-button color="basic" [disabled]="!formOH.valid || isLoading" (click)="onRevisePM()">
            Revise
        </button>
        <button *ngIf="data.Header.CHECK_REPH_ID && data.Header.STATUSID!=STATUS_CANCEL" class="button" mat-flat-button
            color="warn" [disabled]="!formOH.valid || isLoading" (click)="onCancelPM()">
            Cancel
        </button>
    </mat-card-actions>
    <form (ngSubmit)="SavePM()" #formOH="ngForm" autocomplete="off">

        <div class="row">
            <!-- <div class="col-lg-6">
                <mat-card-header>
                    <mat-card-title>Checklist/Repair No. : {{data.Header.CHECK_REP_NO}}</mat-card-title>
                </mat-card-header>
            </div>
            <div class="col-lg-6">
                <mat-card-header class="text-right">
                    <mat-card-title>Status : {{status.STATUSID + ' : ' + status.STATUSNAME}}</mat-card-title>
                </mat-card-header>
            </div> -->
            <div class="col-lg-6">
                <h2><span class="flex-title">Checklist/Repair No. : {{data.Header.CHECK_REP_NO}}</span></h2>
            </div>
            <div class="col-lg-6">
                <h2><span class="flex-status">Status : {{status.STATUSID + ' : ' + status.STATUSNAME}}</span></h2>
            </div>
        </div>

        <mat-accordion [multi]="true">

            <mat-expansion-panel [expanded]="true">
                <mat-expansion-panel-header [@.disabled]="true" expandedHeight="54px" collapsedHeight="54px">
                    <mat-panel-title>Preventive Maintenance Information
                    </mat-panel-title>
                    <!-- <mat-panel-description>
                            Type your name and age
                        </mat-panel-description> -->
                </mat-expansion-panel-header>

                <mat-card-content>
                    <div class="col-12">
                        <div class="row">

                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Machine No.</mat-label>
                                <select matNativeControl id="MachineNo" name="MachineNo"
                                    [(ngModel)]="data.Header.MACHINE_NO"
                                    (change)="data.Header.MACHINE_NAME=getSelectedMachineName($event)">
                                    <!-- <option value=""></option> -->
                                    <option *ngFor="let c of comboMachine" [value]="c.VALUE">{{c.DISPLAY}}
                                    </option>
                                </select>
                            </mat-form-field>

                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Machine Name</mat-label>
                                <input matInput required id="MachineName" name="MachineName" type="text"
                                    [(ngModel)]="data.Header.MACHINE_NAME">
                            </mat-form-field>

                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Request Date</mat-label>
                                <input matInput required [matDatepicker]="ReqDate" id="ReqDate" name="ReqDate"
                                    [(ngModel)]="data.Header.REQUEST_DATE">
                                <mat-datepicker-toggle matSuffix [for]="ReqDate"></mat-datepicker-toggle>
                                <mat-datepicker #ReqDate></mat-datepicker>
                            </mat-form-field>

                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Test Date</mat-label>
                                <input matInput [matDatepicker]="TestDate" id="TestDate" name="TestDate"
                                    [(ngModel)]="data.Header.TEST_DATE">
                                <mat-datepicker-toggle matSuffix [for]="TestDate"></mat-datepicker-toggle>
                                <mat-datepicker #TestDate></mat-datepicker>
                            </mat-form-field>

                        </div>

                        <div class="row">
                            <div class="col-sm-12 col-lg-6">
                                <div class="row">
                                    <mat-form-field class="col-sm-6 col-lg-6">
                                        <mat-label>Person In Charge</mat-label>
                                        <select matNativeControl id="PersonInCharge" name="PersonInCharge"
                                            [disabled]="notHavePermission" [(ngModel)]="SelectedPersonInCharge">
                                            <!-- <option value=""></option> -->
                                            <option *ngFor="let c of comboUserWithPosition" [value]="c.VALUE">
                                                {{c.DISPLAY}}
                                            </option>
                                        </select>
                                    </mat-form-field>
                                    <div class="col-sm-6 col-lg-6">
                                        <button type="button" mat-stroked-button [disabled]="notHavePermission"
                                            (click)="AddPersonIncharge()">Add</button>
                                        <button type="button" mat-stroked-button [disabled]="notHavePermission"
                                            (click)="RemovePersonIncharge()">Remove</button>
                                    </div>
                                </div>
                                <div class="row">
                                    <table class="border" mat-table [dataSource]="dataSourcePersonInCharge">

                                        <!-- checkbox colunm -->
                                        <ng-container matColumnDef="SELECT">
                                            <td mat-cell *matCellDef="let row" class="grid-checkbox-column">
                                                <mat-checkbox (click)="$event.stopPropagation()"
                                                    (change)="$event ? selectionPersonInCharge.toggle(row) : null"
                                                    [checked]="selectionPersonInCharge.isSelected(row)">
                                                </mat-checkbox>
                                            </td>
                                        </ng-container>

                                        <ng-container matColumnDef="DISPLAY">
                                            <td mat-cell *matCellDef="let row"> {{row.DISPLAY}} </td>
                                        </ng-container>

                                        <tr mat-row
                                            *matRowDef="let row; let i = index; columns: displayedColumnsPersonInCharge;"
                                            (click)="selectionPersonInCharge.toggle(row)">
                                        </tr>
                                    </table>
                                </div>
                            </div>

                            <div class="col-sm-12 col-lg-6">

                                <div class="row">
                                    <mat-form-field class="col-sm-6 col-lg-6">
                                        <mat-label>Period</mat-label>
                                        <input matInput id="Period" name="Period" type="number"
                                            [(ngModel)]="data.Header.PERIOD">
                                    </mat-form-field>

                                    <mat-form-field class="col-sm-6 col-lg-6">
                                        <mat-label></mat-label>
                                        <select matNativeControl id="PeriodId" name="PeriodId"
                                            [(ngModel)]="data.Header.PERIOD_ID">
                                            <!-- <option value=""></option> -->
                                            <option *ngFor="let c of comboMachinePeriod" [value]="c.VALUE">
                                                {{c.DISPLAY}}
                                            </option>
                                        </select>
                                    </mat-form-field>

                                </div>

                                <div class="row">

                                    <mat-form-field class="col-sm-6 col-lg-6">
                                        <mat-label>Approver #1</mat-label>
                                        <select matNativeControl id="Approver1" name="Approver1"
                                            [(ngModel)]="data.Header.Approver1">
                                            <!-- <option value=""></option> -->
                                            <option *ngFor="let c of comboUserWithPosition" [value]="c.VALUE">
                                                {{c.DISPLAY}}
                                            </option>
                                        </select>
                                    </mat-form-field>

                                    <mat-form-field class="col-sm-6 col-lg-6">
                                        <mat-label>Approver #2</mat-label>
                                        <select matNativeControl id="Approver2" name="Approver2"
                                            [(ngModel)]="data.Header.Approver2">
                                            <!-- <option value=""></option> -->
                                            <option *ngFor="let c of comboUserWithPosition" [value]="c.VALUE">
                                                {{c.DISPLAY}}
                                            </option>
                                        </select>
                                    </mat-form-field>
                                </div>

                            </div>


                        </div>
                    </div>
                </mat-card-content>


            </mat-expansion-panel>

            <mat-expansion-panel [expanded]="true">
                <mat-expansion-panel-header [@.disabled]="true" expandedHeight="54px" collapsedHeight="54px">
                    <mat-panel-title>Check List and Repair Information
                    </mat-panel-title>
                    <!-- <mat-panel-description>
                            Currently I am {{panelOpenState ? 'open' : 'closed'}}
                        </mat-panel-description> -->
                </mat-expansion-panel-header>

                <mat-card-content>
                    <div class="col-12">
                        <div class="row">

                            <table mat-table [dataSource]="dataSourcePmChecklist">

                                <ng-container matColumnDef="BTN">
                                    <mat-header-cell *matHeaderCellDef></mat-header-cell>
                                    <mat-cell *matCellDef="let row" class="button-column">
                                        <button type="button" class="btn btn-primary btn-sm" data-toggle="modal"
                                            data-target="#exampleModal" (click)="EditPmCheckList(row)">Edit</button>
                                    </mat-cell>
                                </ng-container>

                                <ng-container matColumnDef="PM_CHECKLIST_DESC">
                                    <th mat-header-cell *matHeaderCellDef>Description</th>
                                    <td mat-cell *matCellDef="let row"> {{row.PM_CHECKLIST_DESC}} </td>
                                </ng-container>

                                <ng-container matColumnDef="NORMAL_CHECK_BOOL">
                                    <th mat-header-cell *matHeaderCellDef>Normal</th>
                                    <td mat-cell *matCellDef="let row" class="grid-switch-column">
                                        <label class="switch-sm switch-pill switch-primary switch-column">
                                            <input type="checkbox" class="switch-input"
                                                (change)="row.NORMAL_CHECK_BOOL=$event.target.checked"
                                                [checked]="row.NORMAL_CHECK_BOOL">
                                            <span class="switch-slider"></span>
                                        </label>
                                    </td>
                                </ng-container>

                                <ng-container matColumnDef="PROBLEM_DESC">
                                    <th mat-header-cell *matHeaderCellDef class="text-center">Detail of Problems or
                                        Disorder</th>
                                    <td mat-cell *matCellDef="let row">
                                        <div class="text-column" *ngIf="row.PROBLEM_DESC">{{row.PROBLEM_DESC}}</div>
                                        <!-- <textarea #textbox (change)="row.PROBLEM_DESC = textbox.value">{{row.PROBLEM_DESC}}</textarea> -->
                                    </td>
                                </ng-container>

                                <ng-container matColumnDef="REPAIR_METHOD">
                                    <th mat-header-cell *matHeaderCellDef class="text-center">Repair Method</th>
                                    <td mat-cell *matCellDef="let row">
                                        <div class="text-column" *ngIf="row.REPAIR_METHOD">{{row.REPAIR_METHOD}}</div>
                                    </td>
                                </ng-container>

                                <tr mat-header-row *matHeaderRowDef="displayedColumnsChecklist; sticky: true"></tr>
                                <tr mat-row *matRowDef="let row; let i = index; columns: displayedColumnsChecklist;">
                                </tr>
                            </table>


                        </div>
                    </div>
                </mat-card-content>

            </mat-expansion-panel>

            <mat-expansion-panel [expanded]="true">
                <mat-expansion-panel-header [@.disabled]="true" expandedHeight="54px" collapsedHeight="54px">
                    <mat-panel-title>Parts Component Information
                    </mat-panel-title>
                    <!-- <mat-panel-description>
                                Currently I am {{panelOpenState ? 'open' : 'closed'}}
                            </mat-panel-description> -->
                </mat-expansion-panel-header>

                <mat-card-content>
                    <div class="col-12">
                        <div class="row">
                            <div class="col-sm-6 col-lg-3">
                                <mat-form-field *ngIf="!data.Header.CHECK_REPH_ID" class="col-12" floatLabel="always">
                                    <mat-label>Machine Component</mat-label>
                                    <select matNativeControl id="MachineComponent" name="MachineComponent"
                                        (change)="MachineComponentChange()" [(ngModel)]="selectedMachineComponent">
                                        <!-- <option value=""></option> -->
                                        <option *ngFor="let c of comboMachineComponent" [value]="c.VALUE">{{c.DISPLAY}}
                                        </option>
                                    </select>
                                </mat-form-field>
                            </div>
                            <div class="col-sm-6 col-lg-9" align="end">
                                <button type="button" mat-flat-button color="primary" (click)="addPart()">Add
                                    Parts</button>
                            </div>
                        </div>
                        <div class="row">
                            <table class="border" mat-table [dataSource]="dataSourcePmParts">

                                <ng-container matColumnDef="ACTION">
                                    <th mat-header-cell *matHeaderCellDef>Action</th>
                                    <td mat-cell *matCellDef="let row" class="button-column">
                                        <button type="button" class="btn btn-danger btn-sm"
                                            (click)="deletePart(row)">Delete</button>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="PARTS_LOC_CD">
                                    <th mat-header-cell *matHeaderCellDef>Parts Location</th>
                                    <td mat-cell *matCellDef="let row">
                                        <select matNativeControl [(ngModel)]="row.PARTS_LOC_CD"
                                            [ngModelOptions]="{standalone: true}">
                                            <!-- <option value=""></option> -->
                                            <option *ngFor="let c of comboLocation" [value]="c.VALUE">{{c.DISPLAY}}
                                            </option>
                                        </select>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="PARTS_ITEM_CD">
                                    <th mat-header-cell *matHeaderCellDef>Parts Code</th>
                                    <td mat-cell *matCellDef="let row"> {{row.PARTS_ITEM_CD}} </td>
                                </ng-container>
                                <ng-container matColumnDef="BTN">
                                    <th mat-header-cell *matHeaderCellDef></th>
                                    <td mat-cell *matCellDef="let row" class="button-column">
                                        <button type="button" class="btn btn-primary btn-sm"
                                            (click)="openDialog(row)">...</button>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="PARTS_ITEM_DESC">
                                    <th mat-header-cell *matHeaderCellDef>Parts Name</th>
                                    <td mat-cell *matCellDef="let row"> {{row.PARTS_ITEM_DESC}} </td>
                                </ng-container>
                                <ng-container matColumnDef="REQUEST_QTY">
                                    <th mat-header-cell *matHeaderCellDef>Request Quantity</th>
                                    <td mat-cell *matCellDef="let row">
                                        <input matInput type="number" [(ngModel)]="row.REQUEST_QTY"
                                            [ngModelOptions]="{standalone: true}">
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="IN_QTY">
                                    <th mat-header-cell *matHeaderCellDef>In Quantity</th>
                                    <td mat-cell *matCellDef="let row"> {{row.IN_QTY}} </td>
                                </ng-container>
                                <ng-container matColumnDef="USED_QTY">
                                    <th mat-header-cell *matHeaderCellDef>Used Quantity</th>
                                    <td mat-cell *matCellDef="let row">
                                        <input matInput type="number" [(ngModel)]="row.USED_QTY"
                                            [ngModelOptions]="{standalone: true}">
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="UNITCODE">
                                    <th mat-header-cell *matHeaderCellDef>Unit</th>
                                    <td mat-cell *matCellDef="let row">
                                        <select matNativeControl [(ngModel)]="row.UNITCODE"
                                            [ngModelOptions]="{standalone: true}">
                                            <!-- <option value=""></option> -->
                                            <option *ngFor="let c of comboItemUnit" [value]="c.VALUE" selected>
                                                {{c.DISPLAY}}
                                            </option>
                                        </select>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="REMARK">
                                    <th mat-header-cell *matHeaderCellDef>Remark</th>
                                    <td mat-cell *matCellDef="let row">
                                        <input matInput type="text" [(ngModel)]="row.REMARK"
                                            [ngModelOptions]="{standalone: true}">
                                    </td>
                                </ng-container>

                                <tr mat-header-row *matHeaderRowDef="displayedColumnsPart; sticky: true"></tr>
                                <tr mat-row *matRowDef="let row; let i = index; columns: displayedColumnsPart;">
                                </tr>
                            </table>


                        </div>
                    </div>
                </mat-card-content>

            </mat-expansion-panel>

        </mat-accordion>


        <mat-card-actions>
            <button mat-flat-button color="primary" type="submit" [disabled]="!formOH.valid || isLoading">Save</button>
            <button mat-flat-button (click)="Back()">Back</button>
        </mat-card-actions>

    </form>
</mat-card>

<!-- cr -->
<mat-card *ngIf="data && data.Header.SCHEDULE_TYPEID===3" class="animated fadeIn card-margin">
    <mat-card-actions *ngIf="data.Header.CHECK_REPH_ID">
        <button
            *ngIf="data.Header.CHECK_REPH_ID && (data.Header.STATUSID===STATUS_NEW || data.Header.STATUSID===STATUS_DURING_ASSIGN)"
            class="button" mat-flat-button color="primary" [disabled]="!formCR.valid || isLoading || notHavePermission"
            (click)="onConfirmCR()">
            Confirm
        </button>
        <button
            *ngIf="data.Header.CHECK_REPH_ID && data.Header.STATUSID===STATUS_RECEIVED || data.Header.STATUSID===STATUS_REVISE"
            class="button" mat-flat-button color="primary" [disabled]="!formCR.valid || isLoading || notHavePermission"
            (click)="onSendToApproveCR()">
            Send to Approve
        </button>
        <button *ngIf="data.Header.CHECK_REPH_ID && data.Header.STATUSID===STATUS_DURING_APPROVE " class="button"
            mat-flat-button color="primary" [disabled]="!formCR.valid || isLoading || notHavePermission"
            (click)="onApproveCR()">
            Approve
        </button>
        <button *ngIf="data.Header.CHECK_REPH_ID && data.Header.STATUSID===STATUS_DURING_APPROVE" class="button"
            mat-flat-button color="basic" [disabled]="!formCR.valid || isLoading || notHavePermission"
            (click)="onReviseCR()">
            Revise
        </button>


        <button
            *ngIf="data.Header.CHECK_REPH_ID && data.Header.STATUSID!=STATUS_CANCEL && data.Header.STATUSID!=STATUS_DURING_APPROVE && data.Header.STATUSID!=STATUS_COMPLETE"
            class="button" mat-flat-button color="warn" [disabled]="!formCR.valid || isLoading || notHavePermission"
            (click)="onCancelCR()">
            Cancel
        </button>
    </mat-card-actions>

    <form (ngSubmit)="SaveCR()" #formCR="ngForm" autocomplete="off">

        <!-- header -->
        <div class="row">
            <!-- <div class="col-lg-6">
                <mat-card-header>
                    <mat-card-title>Checklist/Repair No. : {{data.Header.CHECK_REP_NO}}</mat-card-title>
                </mat-card-header>
            </div>
            <div class="col-lg-6">
                <mat-card-header>
                    <mat-card-title class=flex-status>
                        Status : {{status.STATUSID + ' : ' + status.STATUSNAME}}
                    </mat-card-title>
                </mat-card-header>
            </div> -->
            <div class="col-lg-6">
                <h2><span class="flex-title">Checklist/Repair No. : {{data.Header.CHECK_REP_NO}}</span></h2>
            </div>
            <div class="col-lg-6">
                <h2><span class="flex-status">Status : {{status.STATUSID + ' : ' + status.STATUSNAME}}</span></h2>
            </div>
        </div>

        <mat-accordion [multi]="true">

            <!-- Repair Requisition Information -->
            <mat-expansion-panel [expanded]="data.Header.STATUSID==STATUS_NEW">
                <mat-expansion-panel-header [@.disabled]="true" expandedHeight="54px" collapsedHeight="54px">
                    <mat-panel-title>Repair Requisition Information</mat-panel-title>
                    <!-- <mat-panel-description>
                            Type your name and age
                        </mat-panel-description> -->
                </mat-expansion-panel-header>

                <mat-card-content>
                    <div class="col-12">
                        <div class="row">
                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Request Date</mat-label>
                                <input [disabled]="data.Header.STATUSID!=STATUS_NEW || notHavePermission" matInput
                                    required [matDatepicker]="REQUEST_DATE" id="REQUEST_DATE" name="REQUEST_DATE"
                                    [(ngModel)]="data.Header.REQUEST_DATE">
                                <mat-datepicker-toggle matSuffix [for]="REQUEST_DATE"></mat-datepicker-toggle>
                                <mat-datepicker #REQUEST_DATE></mat-datepicker>
                            </mat-form-field>

                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Start Require Date</mat-label>
                                <input [disabled]="data.Header.STATUSID!=STATUS_NEW || notHavePermission" matInput
                                    [matDatepicker]="START_REQ_DATE" id="START_REQ_DATE" name="START_REQ_DATE"
                                    [(ngModel)]="data.Header.START_REQ_DATE">
                                <mat-datepicker-toggle matSuffix [for]="START_REQ_DATE"></mat-datepicker-toggle>
                                <mat-datepicker #START_REQ_DATE></mat-datepicker>
                            </mat-form-field>


                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Start Time</mat-label>
                                <input [disabled]="data.Header.STATUSID!=STATUS_NEW || notHavePermission" matInput
                                    id="START_REQ_TIME" name="START_REQ_TIME" type="time" placeholder="Time"
                                    [(ngModel)]="data.Header.START_REQ_TIME">
                            </mat-form-field>

                        </div>

                        <div class="row">

                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Machine No.</mat-label>
                                <select [disabled]="data.Header.STATUSID!=STATUS_NEW || notHavePermission"
                                    matNativeControl id="MACHINE_NO" name="MACHINE_NO"
                                    [(ngModel)]="data.Header.MACHINE_NO"
                                    (change)="data.Header.MACHINE_NAME=getSelectedMachineName($event)">
                                    <!-- <option value=""></option> -->
                                    <option *ngFor="let c of comboMachine" [value]="c.VALUE">{{c.DISPLAY}}
                                    </option>
                                </select>
                            </mat-form-field>

                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Machine Name</mat-label>
                                <input [disabled]="data.Header.STATUSID!=STATUS_NEW || notHavePermission" matInput
                                    required id="MACHINE_NAME" name="MACHINE_NAME" type="text"
                                    [(ngModel)]="data.Header.MACHINE_NAME">
                            </mat-form-field>

                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Machine Location</mat-label>
                                <input [disabled]="data.Header.STATUSID!=STATUS_NEW || notHavePermission" matInput
                                    id="MACHINE_LOC" name="MACHINE_LOC" type="text"
                                    [(ngModel)]="data.Header.MACHINE_LOC">
                            </mat-form-field>

                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Part Location</mat-label>
                                <select [disabled]="data.Header.STATUSID!=STATUS_NEW || notHavePermission" required
                                    matNativeControl id="MACHINE_LOC_CD" name="MACHINE_LOC_CD"
                                    [(ngModel)]="data.Header.MACHINE_LOC_CD">
                                    <option *ngFor="let c of comboUserApproveLocation" [value]="c.VALUE">
                                        {{c.DISPLAY}}
                                    </option>
                                </select>
                            </mat-form-field>


                        </div>
                        <div class="row">
                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Requester</mat-label>
                                <select [disabled]="data.Header.STATUSID!=STATUS_NEW || notHavePermission"
                                    matNativeControl id="REQUESTER" name="REQUESTER" [(ngModel)]="data.Header.REQUESTER"
                                    (change)="onRequesterChange()">
                                    <!-- <option value=""></option> -->
                                    <option *ngFor="let c of comboUserWithPosition" [value]="c.VALUE">
                                        {{c.DISPLAY}}
                                    </option>
                                </select>
                            </mat-form-field>
                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Position</mat-label>
                                <select disabled matNativeControl id="POSITIONID" name="POSITIONID"
                                    [(ngModel)]="data.Header.POSITIONID">
                                    <!-- <option value=""></option> -->
                                    <option *ngFor="let c of comboPosition" [value]="c.POSITIONID">
                                        {{c.POSITIONNAME}}
                                    </option>
                                </select>
                            </mat-form-field>
                            <mat-form-field class="col-sm-6 col-lg-6">
                                <mat-label>Trouble</mat-label>
                                <textarea [disabled]="data.Header.STATUSID!=STATUS_NEW || notHavePermission" matInput
                                    id="TROUBLE" name="TROUBLE" type="text"
                                    [(ngModel)]="data.Header.TROUBLE"></textarea>
                            </mat-form-field>
                        </div>


                    </div>
                </mat-card-content>


            </mat-expansion-panel>

            <!-- Maintenance Information -->
            <mat-expansion-panel
                [expanded]="data.Header.STATUSID==STATUS_DURING_ASSIGN || data.Header.STATUSID==STATUS_RECEIVED || data.Header.STATUSID==STATUS_REVISE || data.Header.STATUSID==STATUS_DURING_APPROVE">
                <mat-expansion-panel-header [@.disabled]="true" expandedHeight="54px" collapsedHeight="54px">
                    <mat-panel-title>Maintenance Information </mat-panel-title>
                </mat-expansion-panel-header>

                <mat-card-content>
                    <div class="col-12">
                        <div class="row">
                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Received Request Date</mat-label>
                                <input
                                    [disabled]="(data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)  || notHavePermission"
                                    matInput [matDatepicker]="REC_REQUEST_DATE" id="REC_REQUEST_DATE"
                                    name="REC_REQUEST_DATE" [(ngModel)]="data.Header.REC_REQUEST_DATE">
                                <mat-datepicker-toggle matSuffix [for]="REC_REQUEST_DATE">
                                </mat-datepicker-toggle>
                                <mat-datepicker #REC_REQUEST_DATE></mat-datepicker>
                            </mat-form-field>


                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Received Time</mat-label>
                                <input
                                    [disabled]="(data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE) || notHavePermission"
                                    matInput id="REC_REQUEST_TIME" name="REC_REQUEST_TIME" type="time"
                                    [(ngModel)]="data.Header.REC_REQUEST_TIME">
                            </mat-form-field>

                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Complete Date</mat-label>
                                <input
                                    [disabled]="(data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE) || notHavePermission"
                                    matInput [matDatepicker]="COMPLETE_DATE" id="COMPLETE_DATE" name="COMPLETE_DATE"
                                    [(ngModel)]="data.Header.COMPLETE_DATE">
                                <mat-datepicker-toggle matSuffix [for]="COMPLETE_DATE">
                                </mat-datepicker-toggle>
                                <mat-datepicker #COMPLETE_DATE></mat-datepicker>
                            </mat-form-field>


                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Complete Time</mat-label>
                                <input
                                    [disabled]="(data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE) || notHavePermission"
                                    matInput id="COMPLETE_TIME" name="COMPLETE_TIME" type="time"
                                    [(ngModel)]="data.Header.COMPLETE_TIME">
                            </mat-form-field>
                        </div>



                        <div class="row">
                            <div class="col-sm-6 col-lg-3">
                                <mat-checkbox
                                    [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE && data.Header.STATUSID!=STATUS_DURING_ASSIGN)"
                                    labelPosition="before" name="SKIP_APPROVAL" id="SKIP_APPROVAL"
                                    [checked]="data.Header.SKIP_APPROVAL==='Y'"
                                    (change)="data.Header.SKIP_APPROVAL=GetCheckedYn($event)">
                                    Skip Approval
                                </mat-checkbox>
                            </div>
                            <div class="col-sm-6 col-lg-3">
                                <mat-label>Approve</mat-label>
                                <mat-radio-group
                                    [disabled]="data.Header.STATUSID!=STATUS_DURING_ASSIGN || notHavePermission"
                                    [(ngModel)]="data.Header.APPROVE_RQ" [ngModelOptions]="{standalone: true}">
                                    <mat-radio-button value="Y">
                                        Allow
                                    </mat-radio-button>
                                    <mat-radio-button value="N">
                                        Not Allow
                                    </mat-radio-button>
                                </mat-radio-group>
                            </div>

                            <div class="col-sm-12 col-lg-6">
                                <mat-label>Location</mat-label>
                                <mat-radio-group
                                    [disabled]="(data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE) || notHavePermission"
                                    [(ngModel)]="data.Header.IN_OUT_PROD_LINE" [ngModelOptions]="{standalone: true}">
                                    <mat-radio-button value="Y">
                                        In Production Line
                                    </mat-radio-button>
                                    <mat-radio-button value="N">
                                        Outer Production Line
                                    </mat-radio-button>
                                </mat-radio-group>
                            </div>
                        </div>



                        <div class="row">
                            <div class="col-sm-12 col-lg-6">
                                <div class="row">


                                    <mat-form-field class="col-sm-6 col-lg-6">
                                        <mat-label>Assigner</mat-label>
                                        <select disabled matNativeControl id="ASSIGNER" name="ASSIGNER"
                                            [(ngModel)]="data.Header.ASSIGNER"
                                            (change)="data.Header.ASSIGN_POSITIONID=getUserPosition($event.target.value)">
                                            <option *ngFor="let c of comboUserWithPosition" [value]="c.VALUE">
                                                {{c.DISPLAY}}
                                            </option>
                                        </select>
                                    </mat-form-field>

                                    <mat-form-field class="col-sm-6 col-lg-6">
                                        <mat-label>Position</mat-label>
                                        <select disabled matNativeControl id="ASSIGN_POSITIONID"
                                            name="ASSIGN_POSITIONID" [(ngModel)]="data.Header.ASSIGN_POSITIONID">
                                            <option *ngFor="let c of comboPosition" [value]="c.POSITIONID">
                                                {{c.POSITIONNAME}}
                                            </option>
                                        </select>
                                    </mat-form-field>

                                </div>

                                <div class="row">
                                    <mat-form-field class="col-sm-6 col-lg-6">
                                        <mat-label>Person In Charge</mat-label>
                                        <select
                                            [disabled]="(data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE && data.Header.STATUSID!=STATUS_DURING_ASSIGN) || notHavePermission"
                                            matNativeControl id="PersonInCharge" name="PersonInCharge"
                                            [(ngModel)]="SelectedPersonInCharge">
                                            <option *ngFor="let c of comboUserWithPosition" [value]="c.VALUE">
                                                {{c.DISPLAY}}
                                            </option>
                                        </select>
                                    </mat-form-field>
                                    <div class="col-sm-6 col-lg-6">
                                        <button
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE && data.Header.STATUSID!=STATUS_DURING_ASSIGN)"
                                            type="button" mat-stroked-button (click)="AddPersonIncharge()">Add</button>
                                        <button
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE && data.Header.STATUSID!=STATUS_DURING_ASSIGN)"
                                            type="button" mat-stroked-button
                                            (click)="RemovePersonIncharge()">Remove</button>
                                    </div>
                                </div>
                                <div class="row">
                                    <table class="border" mat-table [dataSource]="dataSourcePersonInCharge">
                                        <ng-container matColumnDef="SELECT">
                                            <td mat-cell *matCellDef="let row" class="grid-checkbox-column">
                                                <mat-checkbox (click)="$event.stopPropagation()"
                                                    (change)="$event ? selectionPersonInCharge.toggle(row) : null"
                                                    [checked]="selectionPersonInCharge.isSelected(row)">
                                                </mat-checkbox>
                                            </td>
                                        </ng-container>

                                        <ng-container matColumnDef="DISPLAY">
                                            <td mat-cell *matCellDef="let row"> {{row.DISPLAY}} </td>
                                        </ng-container>

                                        <tr mat-row
                                            *matRowDef="let row; let i = index; columns: displayedColumnsPersonInCharge;"
                                            (click)="selectionPersonInCharge.toggle(row)">
                                        </tr>
                                    </table>
                                </div>
                            </div>

                            <div class="col-sm-12 col-lg-6">
                                <div class="row">
                                    <mat-form-field class="col-12">
                                        <mat-label>Cause of Problem</mat-label>
                                        <input
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                            matInput id="PROBLEM_DESC" name="PROBLEM_DESC" type="text"
                                            [(ngModel)]="data.Header.PROBLEM_DESC">
                                    </mat-form-field>
                                    <mat-form-field class="col-12">
                                        <mat-label>Repair Method</mat-label>
                                        <input
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                            matInput id="REPAIR_METHOD" name="REPAIR_METHOD" type="text"
                                            [(ngModel)]="data.Header.REPAIR_METHOD">
                                    </mat-form-field>
                                    <mat-form-field class="col-12">
                                        <mat-label>Preventive Method</mat-label>
                                        <input
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                            matInput id="PREVENTIVE_METHOD" name="PREVENTIVE_METHOD" type="text"
                                            [(ngModel)]="data.Header.PREVENTIVE_METHOD">
                                    </mat-form-field>
                                    <mat-form-field class="col-12">
                                        <mat-label>Cause of Delay</mat-label>
                                        <input
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                            matInput id="CAUSE_DELAY" name="CAUSE_DELAY" type="text"
                                            [(ngModel)]="data.Header.CAUSE_DELAY">
                                    </mat-form-field>

                                </div>
                            </div>
                        </div>
                        <div class="border">
                            <div class="col-12">

                                <div class="row">
                                    <mat-form-field class="col-sm-12 col-lg-4">
                                        <mat-label>Cleaner (Basic)</mat-label>
                                        <select
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                            matNativeControl id="CLEAN_PERSON" name="CLEAN_PERSON"
                                            [(ngModel)]="data.Header.CLEAN_PERSON"
                                            (change)="data.Header.CLEAN_POSITIONID=getUserPosition($event.target.value)">
                                            <option *ngFor="let c of comboUserWithPosition" [value]="c.VALUE">
                                                {{c.DISPLAY}}
                                            </option>
                                        </select>
                                    </mat-form-field>
                                    <mat-form-field class="col-sm-12 col-lg-4">
                                        <mat-label>Position</mat-label>
                                        <select disabled matNativeControl id="CLEAN_POSITIONID" name="CLEAN_POSITIONID"
                                            [(ngModel)]="data.Header.CLEAN_POSITIONID">
                                            <option *ngFor="let c of comboPosition" [value]="c.POSITIONID">
                                                {{c.POSITIONNAME}}
                                            </option>
                                        </select>
                                    </mat-form-field>
                                    <mat-form-field class="col-sm-12 col-lg-4">
                                        <mat-label>Date</mat-label>
                                        <input disabled matInput [matDatepicker]="CLEAN_DATE" id="CLEAN_DATE"
                                            name="CLEAN_DATE" [(ngModel)]="data.Header.CLEAN_DATE">
                                        <mat-datepicker-toggle matSuffix [for]="CLEAN_DATE"></mat-datepicker-toggle>
                                        <mat-datepicker #CLEAN_DATE></mat-datepicker>
                                    </mat-form-field>
                                </div>

                                <div class="row">
                                    <mat-form-field class="col-sm-12 col-lg-4">
                                        <mat-label>Cleaner the Machine</mat-label>
                                        <select
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                            matNativeControl id="CHECK_MC_PERSON" name="CHECK_MC_PERSON"
                                            [(ngModel)]="data.Header.CHECK_MC_PERSON"
                                            (change)="data.Header.CHECK_MC_POSITIONID=getUserPosition($event.target.value)">
                                            <option *ngFor="let c of comboUserWithPosition" [value]="c.VALUE">
                                                {{c.DISPLAY}}
                                            </option>
                                        </select>
                                    </mat-form-field>
                                    <mat-form-field class="col-sm-12 col-lg-4">
                                        <mat-label>Position</mat-label>
                                        <select disabled matNativeControl id="CHECK_MC_POSITIONID"
                                            name="CHECK_MC_POSITIONID" [(ngModel)]="data.Header.CHECK_MC_POSITIONID">
                                            <option *ngFor="let c of comboPosition" [value]="c.POSITIONID">
                                                {{c.POSITIONNAME}}
                                            </option>
                                        </select>
                                    </mat-form-field>
                                    <mat-form-field class="col-sm-12 col-lg-4">
                                        <mat-label>Date</mat-label>
                                        <input disabled matInput [matDatepicker]="CHECK_MC_DATE" id="CHECK_MC_DATE"
                                            name="CHECK_MC_DATE" [(ngModel)]="data.Header.CHECK_MC_DATE">
                                        <mat-datepicker-toggle matSuffix [for]="CHECK_MC_DATE">
                                        </mat-datepicker-toggle>
                                        <mat-datepicker #CHECK_MC_DATE></mat-datepicker>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                    </div>

                </mat-card-content>

            </mat-expansion-panel>

            <!-- Tools Information -->
            <mat-expansion-panel
                [expanded]="data.Header.STATUSID==STATUS_RECEIVED || data.Header.STATUSID==STATUS_REVISE|| data.Header.STATUSID==STATUS_DURING_APPROVE">
                <mat-expansion-panel-header [@.disabled]="true" expandedHeight="54px" collapsedHeight="54px">
                    <mat-panel-title>Tools Information</mat-panel-title>
                </mat-expansion-panel-header>

                <mat-card-content>
                    <div class="col-12">
                        <div class="row">
                            <table class="border" mat-table [dataSource]="dataSourceCrTools">

                                <ng-container matColumnDef="NO">
                                    <th mat-header-cell *matHeaderCellDef>No.</th>
                                    <td mat-cell *matCellDef="let i = index" class="text-center">{{i+1}}</td>
                                </ng-container>
                                <ng-container matColumnDef="ITEM_CD">
                                    <th mat-header-cell *matHeaderCellDef>Tools Code</th>
                                    <td mat-cell *matCellDef="let row">{{row.ITEM_CD}}</td>
                                </ng-container>
                                <ng-container matColumnDef="ITEM_DESC">
                                    <th mat-header-cell *matHeaderCellDef>Tools Name</th>
                                    <td mat-cell *matCellDef="let row">{{row.ITEM_DESC}}</td>
                                </ng-container>
                                <ng-container matColumnDef="UNITCODE">
                                    <th mat-header-cell *matHeaderCellDef>Unit</th>
                                    <td mat-cell *matCellDef="let row">{{row.UNITCODE}}</td>
                                </ng-container>
                                <ng-container matColumnDef="IN_QTY">
                                    <th mat-header-cell *matHeaderCellDef>Qty</th>
                                    <td mat-cell *matCellDef="let row">
                                        <input
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                            matInput type="number" [(ngModel)]="row.IN_QTY"
                                            [ngModelOptions]="{standalone: true}">
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="IN_CLEAN_BOOL">
                                    <th mat-header-cell *matHeaderCellDef>Clean</th>
                                    <td mat-cell *matCellDef="let row">
                                        <mat-checkbox
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                            [(ngModel)]="row.IN_CLEAN_BOOL" [ngModelOptions]="{standalone: true}">
                                        </mat-checkbox>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="IN_APPEARANCE_BOOL">
                                    <th mat-header-cell *matHeaderCellDef>Appearance</th>
                                    <td mat-cell *matCellDef="let row">
                                        <mat-checkbox
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                            [(ngModel)]="row.IN_APPEARANCE_BOOL" [ngModelOptions]="{standalone: true}">
                                        </mat-checkbox>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="OUT_USEDQTY">
                                    <th mat-header-cell *matHeaderCellDef>Use Qty</th>
                                    <td mat-cell *matCellDef="let row">
                                        <input
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                            matInput type="number" [(ngModel)]="row.OUT_USEDQTY"
                                            [ngModelOptions]="{standalone: true}">
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="OUT_RETURNQTY">
                                    <th mat-header-cell *matHeaderCellDef>Return Qty</th>
                                    <td mat-cell *matCellDef="let row">
                                        <input
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                            matInput type="number" [(ngModel)]="row.OUT_RETURNQTY"
                                            [ngModelOptions]="{standalone: true}">
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="OUT_CLEAN_BOOL">
                                    <th mat-header-cell *matHeaderCellDef>Clean</th>
                                    <td mat-cell *matCellDef="let row">
                                        <mat-checkbox [(ngModel)]="row.OUT_CLEAN_BOOL" [disabled]="notHavePermission"
                                            [ngModelOptions]="{standalone: true}">
                                        </mat-checkbox>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="OUT_APPEARANCE_BOOL">
                                    <th mat-header-cell *matHeaderCellDef>Appearance</th>
                                    <td mat-cell *matCellDef="let row">
                                        <mat-checkbox [(ngModel)]="row.OUT_APPEARANCE_BOOL"
                                            [disabled]="notHavePermission" [ngModelOptions]="{standalone: true}">
                                        </mat-checkbox>
                                    </td>
                                </ng-container>

                                <!-- default group -->
                                <ng-container matColumnDef="header-row-default-group">
                                    <th mat-header-cell *matHeaderCellDef class="text-center" [attr.colspan]="4">
                                    </th>
                                </ng-container>
                                <!-- in group -->
                                <ng-container matColumnDef="header-row-in-group">
                                    <th mat-header-cell *matHeaderCellDef class="text-center" [attr.colspan]="3">
                                        In
                                    </th>
                                </ng-container>

                                <!-- out group -->
                                <ng-container matColumnDef="header-row-out-group">
                                    <th mat-header-cell *matHeaderCellDef class="text-center" [attr.colspan]="4">
                                        Out
                                    </th>
                                </ng-container>

                                <tr mat-header-row
                                    *matHeaderRowDef="['header-row-default-group', 'header-row-in-group','header-row-out-group']">
                                </tr>

                                <tr mat-header-row *matHeaderRowDef="displayedColumnsCrTools; sticky: true"></tr>
                                <tr mat-row *matRowDef="let row; let i = index; columns: displayedColumnsCrTools;">
                                </tr>
                            </table>


                        </div>
                    </div>
                </mat-card-content>

            </mat-expansion-panel>

            <!-- Parts Information -->
            <mat-expansion-panel
                [expanded]="data.Header.STATUSID==STATUS_RECEIVED || data.Header.STATUSID==STATUS_REVISE || data.Header.STATUSID==STATUS_DURING_APPROVE">
                <mat-expansion-panel-header [@.disabled]="true" expandedHeight="54px" collapsedHeight="54px">
                    <mat-panel-title>Parts Information</mat-panel-title>
                </mat-expansion-panel-header>

                <mat-card-content>
                    <div class="col-12">
                        <div class="row">
                            <div class="col-sm-6 col-lg-3">
                                <mat-form-field
                                    *ngIf="!notHavePermission && (data.Header.STATUSID==STATUS_RECEIVED || data.Header.STATUSID==STATUS_REVISE)"
                                    class="col-12" floatLabel="always">
                                    <mat-label>Machine Component</mat-label>
                                    <select matNativeControl id="MachineComponent" name="MachineComponent"
                                        (change)="MachineComponentChangeCR()" [(ngModel)]="selectedMachineComponent">
                                        <option *ngFor="let c of comboMachineComponent" [value]="c.VALUE">{{c.DISPLAY}}
                                        </option>
                                    </select>
                                </mat-form-field>
                            </div>
                            <div class="col-sm-6 col-lg-9" align="end">
                                <button
                                    [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                    type="button" mat-flat-button color="primary" (click)="addPartCr()">
                                    Add Parts
                                </button>
                            </div>
                        </div>
                        <div class="row">
                            <table class="border" mat-table [dataSource]="dataSourceCrParts">
                                <ng-container matColumnDef="NO">
                                    <th mat-header-cell *matHeaderCellDef>No.</th>
                                    <td mat-cell *matCellDef="let i = index" class="text-center">{{i+1}}</td>
                                </ng-container>
                                <ng-container matColumnDef="ACTION">
                                    <th mat-header-cell *matHeaderCellDef>Action</th>
                                    <td mat-cell *matCellDef="let row" class="button-column">
                                        <button
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                            type="button" class="btn btn-danger btn-sm"
                                            (click)="deletePartCr(row)">Delete</button>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="LOC_CD">
                                    <th mat-header-cell *matHeaderCellDef>Parts Location</th>
                                    <td mat-cell *matCellDef="let row">
                                        <select
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                            matNativeControl [(ngModel)]="row.LOC_CD"
                                            [ngModelOptions]="{standalone: true}">
                                            <option *ngFor="let c of comboLocation" [value]="c.VALUE">{{c.DISPLAY}}
                                            </option>
                                        </select>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="ITEM_CD">
                                    <th mat-header-cell *matHeaderCellDef>Parts Code</th>
                                    <td mat-cell *matCellDef="let row"> {{row.ITEM_CD}} </td>
                                </ng-container>
                                <ng-container matColumnDef="BTN">
                                    <th mat-header-cell *matHeaderCellDef></th>
                                    <td mat-cell *matCellDef="let row" class="button-column">
                                        <button
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                            type="button" class="btn btn-primary btn-sm"
                                            (click)="openDialogCr(row)">...</button>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="ITEM_DESC">
                                    <th mat-header-cell *matHeaderCellDef>Parts Name</th>
                                    <td mat-cell *matCellDef="let row"> {{row.ITEM_DESC}} </td>
                                </ng-container>
                                <ng-container matColumnDef="UNITCODE">
                                    <th mat-header-cell *matHeaderCellDef>Unit</th>
                                    <td mat-cell *matCellDef="let row">
                                        <select
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                            matNativeControl [(ngModel)]="row.UNITCODE"
                                            [ngModelOptions]="{standalone: true}">
                                            <option *ngFor="let c of comboItemUnit" [value]="c.VALUE">{{c.DISPLAY}}
                                            </option>
                                        </select>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="REQUEST_QTY">
                                    <th mat-header-cell *matHeaderCellDef>Request Quantity</th>
                                    <td mat-cell *matCellDef="let row">
                                        <input
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                            matInput type="number" [(ngModel)]="row.REQUEST_QTY"
                                            [ngModelOptions]="{standalone: true}">
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="IN_QTY">
                                    <th mat-header-cell *matHeaderCellDef>Qty</th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.IN_QTY}}
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="IN_CLEAN_BOOL">
                                    <th mat-header-cell *matHeaderCellDef>Clean</th>
                                    <td mat-cell *matCellDef="let row">
                                        <mat-checkbox
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                            [(ngModel)]="row.IN_CLEAN_BOOL" [ngModelOptions]="{standalone: true}">
                                        </mat-checkbox>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="IN_APPEARANCE_BOOL">
                                    <th mat-header-cell *matHeaderCellDef>Appearance</th>
                                    <td mat-cell *matCellDef="let row">
                                        <mat-checkbox
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                            [(ngModel)]="row.IN_APPEARANCE_BOOL" [ngModelOptions]="{standalone: true}">
                                        </mat-checkbox>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="OUT_USEDQTY">
                                    <th mat-header-cell *matHeaderCellDef>Used Qty</th>
                                    <td mat-cell *matCellDef="let row">
                                        <input
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                            matInput type="number" [(ngModel)]="row.OUT_USEDQTY"
                                            [ngModelOptions]="{standalone: true}"
                                            (change)="row.OUT_RETURNQTY=calCulateReturnQty(row)">
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="OUT_RETURNQTY">
                                    <th mat-header-cell *matHeaderCellDef>Return Qty</th>
                                    <td mat-cell *matCellDef="let row">
                                        <input
                                            [disabled]="notHavePermission || (data.Header.STATUSID!=STATUS_RECEIVED && data.Header.STATUSID!=STATUS_REVISE)"
                                            matInput type="number" [(ngModel)]="row.OUT_RETURNQTY"
                                            [ngModelOptions]="{standalone: true}">
                                    </td>
                                </ng-container>
                                <!-- <ng-container matColumnDef="OUT_CLEAN_BOOL">
                                    <th mat-header-cell *matHeaderCellDef>Clean</th>
                                    <td mat-cell *matCellDef="let row">
                                        <mat-checkbox [(ngModel)]="row.OUT_CLEAN_BOOL" [disabled]="notHavePermission"
                                            [ngModelOptions]="{standalone: true}">
                                        </mat-checkbox>
                                    </td>
                                </ng-container> -->
                                <ng-container matColumnDef="OUT_CLEAN_BOOL">
                                    <th mat-header-cell *matHeaderCellDef>Clean</th>
                                    <td mat-cell *matCellDef="let row">
                                        <mat-checkbox [(ngModel)]="row.OUT_CLEAN_BOOL" disabled
                                            [ngModelOptions]="{standalone: true}">
                                        </mat-checkbox>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="OUT_APPEARANCE_BOOL">
                                    <th mat-header-cell *matHeaderCellDef>Appearance</th>
                                    <td mat-cell *matCellDef="let row">
                                        <mat-checkbox [(ngModel)]="row.OUT_APPEARANCE_BOOL" disabled
                                            [ngModelOptions]="{standalone: true}">
                                        </mat-checkbox>
                                    </td>
                                </ng-container>

                                <!-- default group -->
                                <ng-container matColumnDef="header-row-default-group">
                                    <th mat-header-cell *matHeaderCellDef class="text-center" [attr.colspan]="7">
                                    </th>
                                </ng-container>
                                <!-- in group -->
                                <ng-container matColumnDef="header-row-in-group">
                                    <th mat-header-cell *matHeaderCellDef class="text-center" [attr.colspan]="3">
                                        In
                                    </th>
                                </ng-container>

                                <!-- out group -->
                                <ng-container matColumnDef="header-row-out-group">
                                    <th mat-header-cell *matHeaderCellDef class="text-center" [attr.colspan]="4">
                                        Out
                                    </th>
                                </ng-container>

                                <tr mat-header-row
                                    *matHeaderRowDef="['header-row-default-group', 'header-row-in-group','header-row-out-group']">
                                </tr>


                                <tr mat-header-row *matHeaderRowDef="displayedColumnsCrPart; sticky: true"></tr>
                                <tr mat-row *matRowDef="let row; let i = index; columns: displayedColumnsCrPart;">
                                </tr>
                            </table>


                        </div>
                    </div>
                </mat-card-content>

            </mat-expansion-panel>

            <!-- Personal Hygiene Information -->
            <mat-expansion-panel [expanded]="data.Header.STATUSID==STATUS_DURING_APPROVE">
                <mat-expansion-panel-header [@.disabled]="true" expandedHeight="54px" collapsedHeight="54px">
                    <mat-panel-title>Personal Hygiene Information</mat-panel-title>
                </mat-expansion-panel-header>

                <mat-card-content>
                    <div class="col-12">
                        <table class="border" mat-table [dataSource]="dataSourceCrPH">

                            <ng-container matColumnDef="NO">
                                <th mat-header-cell *matHeaderCellDef>No.</th>
                                <td mat-cell *matCellDef="let i = index" class="text-center">{{i+1}}</td>
                            </ng-container>
                            <ng-container matColumnDef="PERSONAL_DESC">
                                <th mat-header-cell *matHeaderCellDef>Tools Code</th>
                                <td mat-cell *matCellDef="let row">{{row.PERSONAL_DESC}}</td>
                            </ng-container>
                            <ng-container matColumnDef="PASS">
                                <th mat-header-cell *matHeaderCellDef></th>
                                <td mat-cell *matCellDef="let row">
                                    <mat-radio-group
                                        [disabled]="notHavePermission || data.Header.STATUSID!=STATUS_DURING_APPROVE"
                                        [(ngModel)]="row.PASS_CHECK" [ngModelOptions]="{standalone: true}">
                                        <mat-radio-button value="Y">
                                            Pass
                                        </mat-radio-button>
                                        <mat-radio-button value="N">
                                            Not Pass
                                        </mat-radio-button>
                                    </mat-radio-group>
                                </td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="displayedColumnsCrPH; sticky: true"></tr>
                            <tr mat-row *matRowDef="let row; let i = index; columns: displayedColumnsCrPH;">
                            </tr>
                        </table>

                    </div>
                </mat-card-content>
            </mat-expansion-panel>

            <!-- Check Machine Information -->
            <mat-expansion-panel [expanded]="data.Header.STATUSID==STATUS_DURING_APPROVE">
                <mat-expansion-panel-header [@.disabled]="true" expandedHeight="54px" collapsedHeight="54px">
                    <mat-panel-title>Check Machine Information</mat-panel-title>
                </mat-expansion-panel-header>

                <mat-card-content>
                    <div class="col-12">
                        <div class="row">
                            <div class="col-sm-12 col-lg-4">
                                <mat-radio-group
                                    [disabled]="notHavePermission || data.Header.STATUSID!=STATUS_DURING_APPROVE"
                                    id="CHECK_MC_ID" name="CHECK_MC_ID" [(ngModel)]="data.Check.CHECK_MC_ID"
                                    [ngModelOptions]="{standalone: true}">
                                    <mat-radio-button class="example-radio-button"
                                        *ngFor="let item of rdoCheckMachineItem" [value]="item.VALUE">
                                        {{item.DISPLAY}}
                                    </mat-radio-button>
                                </mat-radio-group>
                            </div>

                            <mat-form-field class="col-sm-6 col-lg-4">
                                <mat-label>Period From</mat-label>
                                <input [disabled]="notHavePermission || data.Check.CHECK_MC_ID!=3" matInput
                                    [matDatepicker]="CHECK_MC_DATE_FR" id="CHECK_MC_DATE_FR" name="CHECK_MC_DATE_FR"
                                    [(ngModel)]="data.Check.CHECK_MC_DATE_FR">
                                <mat-datepicker-toggle matSuffix [for]="CHECK_MC_DATE_FR"></mat-datepicker-toggle>
                                <mat-datepicker #CHECK_MC_DATE_FR></mat-datepicker>
                            </mat-form-field>

                            <mat-form-field class="col-sm-6 col-lg-4">
                                <mat-label>To</mat-label>
                                <input [disabled]="notHavePermission || data.Check.CHECK_MC_ID!=3" matInput
                                    [matDatepicker]="CHECK_MC_DATE_TO" id="CHECK_MC_DATE_TO" name="CHECK_MC_DATE_TO"
                                    [(ngModel)]="data.Check.CHECK_MC_DATE_TO">
                                <mat-datepicker-toggle matSuffix [for]="CHECK_MC_DATE_TO"></mat-datepicker-toggle>
                                <mat-datepicker #CHECK_MC_DATE_TO></mat-datepicker>
                            </mat-form-field>

                        </div>



                        <div class="row">

                            <mat-form-field class="col-sm-12 col-lg-4">
                                <mat-label>Received by</mat-label>
                                <select [disabled]="notHavePermission || data.Header.STATUSID!=STATUS_DURING_APPROVE"
                                    matNativeControl id="CHECK_MC_PERSON_C" name="CHECK_MC_PERSON_C"
                                    [(ngModel)]="data.Check.CHECK_MC_PERSON"
                                    (change)="data.Header.CHECK_MC_POSITIONID=getUserPosition($event.target.value)">
                                    <option *ngFor="let c of comboUserWithPosition" [value]="c.VALUE">
                                        {{c.DISPLAY}}
                                    </option>
                                </select>
                            </mat-form-field>
                            <mat-form-field class="col-sm-12 col-lg-4">
                                <mat-label>Position</mat-label>
                                <select disabled matNativeControl id="CHECK_MC_POSITIONID_C"
                                    name="CHECK_MC_POSITIONID_C" [(ngModel)]="data.Check.CHECK_MC_POSITIONID">
                                    <option *ngFor="let c of comboPosition" [value]="c.POSITIONID">
                                        {{c.POSITIONNAME}}
                                    </option>
                                </select>
                            </mat-form-field>
                            <mat-form-field class="col-sm-12 col-lg-4">
                                <mat-label>Date</mat-label>
                                <input [disabled]="notHavePermission || data.Header.STATUSID!=STATUS_DURING_APPROVE"
                                    matInput [matDatepicker]="CHECK_MC_DATE_C" id="CHECK_MC_DATE_C"
                                    name="CHECK_MC_DATE_C" [(ngModel)]="data.Check.CHECK_MC_DATE">
                                <mat-datepicker-toggle matSuffix [for]="CHECK_MC_DATE_C"></mat-datepicker-toggle>
                                <mat-datepicker #CHECK_MC_DATE_C></mat-datepicker>
                            </mat-form-field>

                        </div>

                    </div>
                </mat-card-content>
            </mat-expansion-panel>

            <!-- Clean Machine Information -->
            <mat-expansion-panel [expanded]="data.Header.STATUSID==STATUS_DURING_APPROVE">
                <mat-expansion-panel-header [@.disabled]="true" expandedHeight="54px" collapsedHeight="54px">
                    <mat-panel-title>Clean Machine Information</mat-panel-title>
                </mat-expansion-panel-header>

                <mat-card-content>
                    <div class="col-12">

                        <div class="row">

                            <div class="col-sm-12 col-lg-4">
                                <span class="col-2">
                                    <mat-checkbox
                                        [disabled]="notHavePermission || data.Header.STATUSID!=STATUS_DURING_APPROVE"
                                        [checked]="data.Check.CLEAN_FLAG==='Y'"
                                        (change)="data.Check.CLEAN_FLAG=GetCheckedYn($event)"></mat-checkbox>
                                </span>
                                <mat-form-field class="col-10">
                                    <mat-label>Person in Charge</mat-label>
                                    <select
                                        [disabled]="notHavePermission || data.Header.STATUSID!=STATUS_DURING_APPROVE"
                                        matNativeControl id="CLEAN_PERSON_C" name="CLEAN_PERSON_C"
                                        [(ngModel)]="data.Check.CLEAN_PERSON"
                                        (change)="data.Header.CLEAN_POSITIONID=getUserPosition($event.target.value)">
                                        <option *ngFor="let c of comboUserWithPosition" [value]="c.VALUE">
                                            {{c.DISPLAY}}
                                        </option>
                                    </select>
                                </mat-form-field>
                            </div>
                            <mat-form-field class="col-sm-12 col-lg-4">
                                <mat-label>Position</mat-label>
                                <select disabled matNativeControl id="CLEAN_POSITIONID_C" name="CLEAN_POSITIONID_C"
                                    [(ngModel)]="data.Check.CLEAN_POSITIONID">
                                    <option *ngFor="let c of comboPosition" [value]="c.POSITIONID">
                                        {{c.POSITIONNAME}}
                                    </option>
                                </select>
                            </mat-form-field>
                            <mat-form-field class="col-sm-12 col-lg-4">
                                <mat-label>Date</mat-label>
                                <input [disabled]="notHavePermission || data.Header.STATUSID!=STATUS_DURING_APPROVE"
                                    matInput [matDatepicker]="CLEAN_DATE_C" id="CLEAN_DATE_C" name="CLEAN_DATE_C"
                                    [(ngModel)]="data.Check.CLEAN_DATE">
                                <mat-datepicker-toggle matSuffix [for]="CLEAN_DATE_C"></mat-datepicker-toggle>
                                <mat-datepicker #CLEAN_DATE_C></mat-datepicker>
                            </mat-form-field>

                        </div>

                    </div>
                </mat-card-content>
            </mat-expansion-panel>

            <!-- Quality Control -->
            <mat-expansion-panel [expanded]="data.Header.STATUSID==STATUS_DURING_APPROVE">
                <mat-expansion-panel-header [@.disabled]="true" expandedHeight="54px" collapsedHeight="54px">
                    <mat-panel-title>Quality Control</mat-panel-title>
                </mat-expansion-panel-header>

                <mat-card-content>
                    <div class="col-12">
                        <div class="row">
                            <div class="col-sm-12 col-lg-4">
                                <mat-radio-group
                                    [disabled]="notHavePermission || data.Header.STATUSID!=STATUS_DURING_APPROVE"
                                    [(ngModel)]="data.Check.QC_CHECK" [ngModelOptions]="{standalone: true}">
                                    <mat-radio-button value="N">Not Found Defect</mat-radio-button>
                                    <mat-radio-button value="Y">Found Defect</mat-radio-button>
                                </mat-radio-group>
                            </div>

                            <mat-form-field class="col-sm-12 col-lg-8">
                                <input [disabled]="notHavePermission || data.Header.STATUSID!=STATUS_DURING_APPROVE"
                                    matInput id="QC_CHECK_DESC" name="QC_CHECK_DESC" type="text"
                                    [(ngModel)]="data.Check.QC_CHECK_DESC">
                            </mat-form-field>

                        </div>



                        <div class="row">

                            <mat-form-field class="col-sm-12 col-lg-4">
                                <mat-label>Received by</mat-label>
                                <select matNativeControl id="QC_PERSON" name="QC_PERSON" [disabled]="notHavePermission"
                                    [(ngModel)]="data.Check.QC_PERSON"
                                    (change)="data.Header.QC_POSITIONID=getUserPosition($event.target.value)">
                                    <option *ngFor="let c of comboUserWithPosition" [value]="c.VALUE">
                                        {{c.DISPLAY}}
                                    </option>
                                </select>
                            </mat-form-field>
                            <mat-form-field class="col-sm-12 col-lg-4">
                                <mat-label>Position</mat-label>
                                <select disabled matNativeControl id="QC_POSITIONID" name="QC_POSITIONID"
                                    [(ngModel)]="data.Check.QC_POSITIONID">
                                    <option *ngFor="let c of comboPosition" [value]="c.POSITIONID">
                                        {{c.POSITIONNAME}}
                                    </option>
                                </select>
                            </mat-form-field>
                            <mat-form-field class="col-sm-12 col-lg-4">
                                <mat-label>Date</mat-label>
                                <input matInput [matDatepicker]="QC_DATE_C" id="QC_DATE_C" name="QC_DATE_C"
                                    [disabled]="notHavePermission" [(ngModel)]="data.Check.QC_DATE">
                                <mat-datepicker-toggle matSuffix [for]="QC_DATE_C"></mat-datepicker-toggle>
                                <mat-datepicker #QC_DATE_C></mat-datepicker>
                            </mat-form-field>

                        </div>

                    </div>
                </mat-card-content>
            </mat-expansion-panel>

            <!-- After Service Information -->
            <mat-expansion-panel [expanded]="data.Header.STATUSID==STATUS_COMPLETE">
                <mat-expansion-panel-header [@.disabled]="true" expandedHeight="54px" collapsedHeight="54px">
                    <mat-panel-title>After Service Information</mat-panel-title>
                </mat-expansion-panel-header>

                <mat-card-content>
                    <div class="col-12">
                        <div class="row">
                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>#1</mat-label>
                                <input disabled matInput [matDatepicker]="AFTERSV_DATE_1" id="AFTERSV_DATE_1"
                                    name="AFTERSV_DATE_1" [(ngModel)]="data.AfterService.AFTERSV_DATE_1">
                                <mat-datepicker-toggle matSuffix [for]="AFTERSV_DATE_1"></mat-datepicker-toggle>
                                <mat-datepicker #AFTERSV_DATE_1></mat-datepicker>
                            </mat-form-field>
                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Checklist/Repair No.</mat-label>
                                <input disabled matInput id="AFTERSV_CHECK_REP_NO_1" name="AFTERSV_CHECK_REP_NO_1"
                                    type="text" [(ngModel)]="data.AfterService.AFTERSV_CHECK_REP_NO_1">
                            </mat-form-field>
                        </div>
                        <div class="row">
                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>#2</mat-label>
                                <input disabled matInput [matDatepicker]="AFTERSV_DATE_2" id="AFTERSV_DATE_2"
                                    name="AFTERSV_DATE_2" [(ngModel)]="data.AfterService.AFTERSV_DATE_2">
                                <mat-datepicker-toggle matSuffix [for]="AFTERSV_DATE_2"></mat-datepicker-toggle>
                                <mat-datepicker #AFTERSV_DATE_2></mat-datepicker>
                            </mat-form-field>
                            <mat-form-field class="col-sm-6 col-lg-3">
                                <mat-label>Checklist/Repair No.</mat-label>
                                <input disabled matInput id="AFTERSV_CHECK_REP_NO_2" name="AFTERSV_CHECK_REP_NO_2"
                                    type="text" [(ngModel)]="data.AfterService.AFTERSV_CHECK_REP_NO_2">
                            </mat-form-field>
                        </div>


                    </div>
                </mat-card-content>
            </mat-expansion-panel>

        </mat-accordion>


        <mat-card-actions>
            <button mat-flat-button color="primary" type="submit"
                [disabled]="notHavePermission || !formCR.valid || isLoading">Save</button>
            <button mat-flat-button (click)="Back()">Back</button>
        </mat-card-actions>

    </form>
</mat-card>


<form *ngIf="tempPmData" (ngSubmit)="SaveChecklist()" #formChecklist="ngForm" autocomplete="off">
    <mat-card class="animated fadeIn card-margin">
        <mat-card-header>
            <mat-card-title>Edit PM Checklist</mat-card-title>
        </mat-card-header>
        <mat-card-content>

            <div class="col-12">
                <div class="row">

                    <mat-form-field class="col-12">
                        <mat-label>Description</mat-label>
                        <textarea matInput disabled id="Description" name="Description"
                            [(ngModel)]="tempPmData.PM_CHECKLIST_DESC"></textarea>
                    </mat-form-field>

                    <div class="col-12 checkbox-row">
                        <label class="switch-sm switch-pill switch-primary switch-column">
                            <input #chkNormal type="checkbox" class="switch-input"
                                (change)="tempPmData.NORMAL_CHECK_BOOL = chkNormal.checked"
                                [checked]="tempPmData.NORMAL_CHECK_BOOL===true">
                            <span class="switch-slider"></span>
                        </label>
                        <mat-label class="checkbox-label">Normal</mat-label>
                    </div>

                    <mat-form-field class="col-12">
                        <mat-label>Detail of Problems or Disorder</mat-label>
                        <textarea #PROBLEM_DESC matInput id="PROBLEM_DESC" name="PROBLEM_DESC" rows="3"
                            [(ngModel)]="tempPmData.PROBLEM_DESC"></textarea>
                    </mat-form-field>

                    <mat-form-field class="col-12">
                        <mat-label>Repair Method required</mat-label>
                        <textarea #REPAIR_METHOD matInput id="REPAIR_METHOD" name="REPAIR_METHOD" rows="3"
                            [(ngModel)]="tempPmData.REPAIR_METHOD"></textarea>
                    </mat-form-field>
                </div>
            </div>

        </mat-card-content>
        <mat-card-actions>
            <button mat-flat-button color="primary" type="submit"
                [disabled]="!formChecklist.valid || isLoading">Save</button>
            <button mat-flat-button type="button" (click)="CloseFormChecklist()">Back</button>
        </mat-card-actions>
    </mat-card>
</form>